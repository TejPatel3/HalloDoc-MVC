@using Services.ViewModels
@model ViewUploadViewModel


<Partial name="Toast" />

@{
    Layout = null;
}

<div class="container  pt-3 pb-4">
    <div class="d-flex justify-content-between mb-2">
        <h4>Documents</h4>
        <a asp-action="AdminDashboard"
           class="btn m-0 btn-outline-info  px-2 ">
            <i class="fa-solid fa-chevron-left"></i>
            Back
        </a>
    </div>
    <div class="container-fluid bg-white shadow px-3 pt-3">
        <div class="row">
            <div class="col-12  text-secondary " style="font-size:15px;">Patient Name</div>
            <div class="col-12 text-secondary">

                <div>
                    <strong class="h4 text-info fw-bold">@Model.FirstName @Model.LastName </strong>
                    <label class="fw-bold"> (@Model.ConfirmationNumber)</label>
                </div>

            </div>

            <div class="col-12  text-secondary pt-2" style="font-size:13px;">Check here for any files that you or the doctors of your subsequenc requests have attached for you to review</div>
            <div class="mt-1">
                @* <form enctype="multipart/form-data">
                <div class="row d-flex">
                <div class="py-2 col-12 ">
                <div class="form-group rounded d-flex align-items-center justify-content-between uploadbtndiv">
                <div class="px-3 table-responsive">
                <input type="file" id="actual-btn" multiple hidden asp-for="Upload" />
                <label role="button" for="actual-btn" id="file-chosen" class="choosenfile text-dark text-nowrap">No item selected</label>
                </div>
                <button type="button" id="uploadBtnAdmin" class="uploadbtn px-2 py-1 d-flex ms-1 border-0">
                <label role="button" class="d-flex align-items-center"><i class="bi bi-cloud-arrow-up p-2"></i><div>Upload</div></label>
                </button>
                </div>
                </div>
                </div>
                </form> *@
                <form>
                    <div class="row d-flex mt-3">
                        <div class="py-2 col-12 ">
                            <div class="form-group rounded d-flex align-items-center justify-content-between border border-2 uploadbtndiv">
                                <div class="px-3 table-responsive w-100">
                                    <input type="file" id="actual-btn" asp-for="Upload" multiple hidden />
                                    <input type="text" class="RequestsId" value="@Model.requestid" hidden />
                                    <label role="button" for="actual-btn" id="file-chosen" class="choosenfile text-nowrap text-secondary w-100">No item selected</label>
                                </div>
                                <button type="button" class="uploadbtn px-2 py-1 d-flex ms-1 border-0">
                                    <label role="button" class="d-flex align-items-center">
                                        <i class="bi bi-cloud-arrow-up p-2"></i>
                                        <div>Upload</div>
                                    </label>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="d-flex justify-content-between mb-2 pt-3">
            <div>
                <h5>Documents</h5>

            </div>
            <div>

                <button type="button" class="btn m-0 btn-outline-info  px-2 mx-1 shadow-none" onclick="download()">
                    <i class="bi bi-cloud-arrow-down d-block d-sm-none"></i>
                    <label class="d-sm-block d-none">
                        Download all
                    </label>
                </button>
                <button type="button" class="btn m-0 btn-outline-info  px-2 mx-1 shadow-none" id="DeleteAll">
                    <i class="bi bi-trash  d-block d-sm-none"></i>
                    <label class="d-sm-block d-none">

                        Delete All
                    </label>
                </button>
                <button type="button" class="btn m-0 btn-outline-info  px-2 mx-1 shadow-none" id="sendMail">
                    <i class="bi bi-envelope d-block d-sm-none"></i>
                    <label class="d-sm-block d-none">

                        Send Mail
                    </label>
                </button>
            </div>
        </div>
        <span id="downloadallbtn-viewupload" class="text-danger"></span>

        <div class="table-responsive">

            <table class="table">
                <thead class="thead-light">
                    <tr>
                        <th scope="col"><input type="checkbox" id="downloadall" /></th>
                        <th scope="col">Documents</th>
                        <th scope="col">Upload Date</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.wiseFiles)
                    {

                        <tr>
                            <td scope="row"><input type="checkbox" name="checkbox" class="childCheckbox" id="@item.RequestWiseFileId" /></td>
                            <td>@item.FileName.Substring(52)</td>
                            <td>  @item.CreatedDate.ToString("MMM dd , yyyy")</td>
                            <td>
                                <a class="text-decoration-none  btn btn-outline-info" href="~/UploadDocument/@item.FileName.Substring(52)" download>
                                    <i class="bi bi-cloud-arrow-down"></i>
                                </a>
                                <div class=" btn btn-outline-info DeleteDoc" id="@item.RequestWiseFileId">
                                    <i class="bi bi-trash  "></i>
                                </div>
                            </td>
                        </tr>
                    }

                </tbody>
            </table>
        </div>


    </div>
</div>

<script src="~/js/Admin/ViewUpload.js" asp-append-version="true"> </script>
@*
    $('.uploadbtn').on('click', function (e) {
        e.preventDefault();

        var formData = new FormData();
        for (var i = 0; i < actualBtn.files.length; i++) {
            formData.append('files', actualBtn.files[i]); // Append each selected file
        }
        formData.append('RequestsId' , @Model.RequestsId);
        console.log(formData);
        // Add any other data you need (e.g., RequestsId)

        $.ajax({
            url: '../Dashboard/UploadFiles', // Replace with your controller action URL
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                $('#nav-tabContent').html(response);
            },
            error: function (error) {
                console.error('Error uploading files:', error);
            }
        });
    }); *@
@*
<script>

    $(document).ready(function () {
        try {
            var actualBtn = document.getElementById('actual-btn');
            var fileChosen = document.getElementById('file-chosen');
            actualBtn.addEventListener('change', function () {
                var filesname = this.files[0].name;
                console.log(filesname)
                for (var i = 1; i < this.files.length; i++) {
                    filesname = filesname + " + " + this.files[i].name;
                }
                fileChosen.style.fontSize = "15px";
                fileChosen.style.fontWeight = "bold"
                fileChosen.textContent = filesname;
                fileChosen.ariaPlaceholder = filesname;
                console.log("run")
            })

            $('.uploadbtn').on('click', function (e) {
                e.preventDefault();
                var formData = new FormData();
                for (var i = 0; i < actualBtn.files.length; i++) {
                    formData.append('file', actualBtn.files[i]); // Append each selected file
                }
                formData.append('id', @Model.requestid);
                console.log(formData);
                // Add any other data you need (e.g., RequestsId)
                $.ajax({
                    url: '../Admin/UploadButton', // Replace with your controller action URL
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        $('#nav-home').html(response);
                    },
                    error: function (error) {
                        console.error('Error uploading files:', error);
                    }
                });
            });
        }
        catch {
            console.log("error");
        }


        // $('#uploadBtnAdmin').on('click', function () {
        //     var actualBtn = document.getElementById('actual-btn');
        //     var formData = new FormData();
        //     for (var i = 0; i < actualBtn.files.length; i++) {
        //         formData.append('files', actualBtn.files[i]); // Append each selected file
        //     }
        //     formData.append('requestid', @Model.requestid);
        //     console.log(formData);
        //     // Add any other data you need (e.g., RequestsId)

        //     $.ajax({
        //         url: '/Admin/UploadButton', // Replace with your controller action URL
        //         type: 'POST',
        //         data: formData,
        //         processData: false,
        //         contentType: false,
        //         success: function (response) {
        //             $('#nav-home').html(response);
        //         },
        //         error: function (error) {
        //             console.error('Error uploading files:', error);
        //         }
        //     });
        // });

        $('#downloadall').click(function () {
            console.log("hjbfgvd")
            $('.childCheckbox').prop('checked', $(this).prop('checked'));
        });

        // Handle individual checkbox clicks to update the leader checkbox state
        $('.childCheckbox').click(function () {
            console.log("another")

            $('#downloadall').prop('checked', $('.childCheckbox:checked').length === $('.childCheckbox').length);
        });


        $('#DeleteAll').click(function () {
            console.log("lol")
            $('.childCheckbox:checked').each(function () {
                var wiseFileId = $(this).attr('id');
                var reqid = @Model.requestid;
                console.log(reqid);
                console.log(wiseFileId);
                $.ajax({
                    url: '/Admin/DeleteDoc', // Replace with your controller action URL
                    type: 'POST',
                    data: {
                        wiseid: wiseFileId,
                        reqId: reqid
                    },

                    success: function (response) {
                        $('#nav-home').html(response);

                    },
                    error: function (error) {
                        console.error('Error uploading files:', error);
                    }
                });
            });
        });

        $('.DeleteDoc').on('click', function () {
            console.log("hello")
            var wiseFileId = $(this).attr('id');
            var reqid = @Model.requestid;
            console.log(wiseFileId)

            console.log(reqid)
            $.ajax({
                url: '/Admin/DeleteDoc', // Replace with your controller action URL
                type: 'POST',
                data: {
                    wiseid: wiseFileId,
                    reqId: reqid
                },

                success: function (response) {
                    $('#nav-home').html(response);

                },
                error: function (error) {
                    console.error('Error uploading files:', error);
                }
            });
        });

        $('#sendMail').on('click', function (e) {
            e.preventDefault();
            console.log("not yet")
            var formData = new FormData();

            $('input[name="checkbox"]:checked').each(function () {
                var wiseid = $(this).attr('id');

            formData.append('wiseFileId', wiseid);
            });

            formData.append('reqid', @Model.requestid);
            console.log(formData);

            $.ajax({
                url: '/Admin/SendMail', // Replace with your controller action URL
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,

                success: function (response) {
                    $('#nav-home').html(response);

                },
                error: function (error) {
                    console.error('Error uploading files:', error);
                }
            });
        })

    });


    // Event listener for download button
    document.getElementById('downloadSelected').addEventListener('click', function (event) {
        event.preventDefault();
        downloadFiles();
    });




                                    // var actualBtn = document.getElementById('actual-btn');
                                    // var fileChosen = document.getElementById('file-chosen');

                                    // actualBtn.addEventListener('change', function () {
                                    //     fileChosen.textContent = this.files[0].name
                                    //     fileChosen.placeholder = this.files[0].name
                                    //     fileChosen.value = this.files[0].name

                                    // })

</script>
 *@
