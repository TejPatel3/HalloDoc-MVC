@using Services.ViewModels
@model ViewUploadViewModel
@inject IHttpContextAccessor accessor


<Partial name="Toast" />

@{
    Layout = null;
}

<div class="container  pt-3 pb-4">
    <div class="d-flex justify-content-between mb-2">
        <h4>Conclude Care</h4>
        <a class="btn m-0 btn-outline-info  px-2" onclick="location.reload()">
            <i class="fa-solid fa-chevron-left"></i>
            Back
        </a>
    </div>
    <div class="container-fluid bg-white shadow px-3 pt-3">
        <div class="row">
            <div class="col-12  text-secondary " style="font-size:15px;">Patient Name</div>
            <div class="col-12 text-secondary">

                <div>
                    <strong class="h4 text-info fw-bold">@Model.FirstName @Model.LastName </strong>
                </div>

            </div>

            <div class="mt-1 d-flex justify-content-between">
                @* <form enctype="multipart/form-data">
                <div class="row d-flex">
                <div class="py-2 col-12 ">
                <div class="form-group rounded d-flex align-items-center justify-content-between uploadbtndiv">
                <div class="px-3 table-responsive">
                <input type="file" id="actual-btn" multiple hidden asp-for="Upload" />
                <label role="button" for="actual-btn" id="file-chosen" class="choosenfile text-dark text-nowrap">No item selected</label>
                </div>
                <button type="button" id="uploadBtnAdmin" class="uploadbtn px-2 py-1 d-flex ms-1 border-0">
                <label role="button" class="d-flex align-items-center"><i class="bi bi-cloud-arrow-up p-2"></i><div>Upload</div></label>
                </button>
                </div>
                </div>
                </div>
                </form> *@
                <div>
                    <h4>Encounter Forms</h4>
                </div>
                <div>

                    <button class="border-0">
                        <input type="file" class="btn btn-outline-info border-0" />
                    </button>
                </div>
                @*  <form>
                <div class="row d-flex mt-3">
                <div class="py-2 col-12 ">
                <div class="form-group rounded d-flex align-items-center justify-content-between border border-2 uploadbtndiv">
                <div class="px-3 table-responsive w-100">
                <input type="file" id="actual-btn-viewupload" asp-for="Upload" multiple hidden />
                <input type="text" class="RequestsId" value="@Model.requestid" hidden />
                <label role="button" for="actual-btn-viewupload" id="file-chosen" class="choosenfile text-nowrap text-secondary w-100">No item selected</label>
                </div>
                <button type="button" class="uploadbtn px-2 py-1 d-flex ms-1 border-0">
                <label role="button" class="d-flex align-items-center">
                <i class="bi bi-cloud-arrow-up p-2"></i>
                <div>Upload</div>
                </label>
                </button>
                </div>
                </div>
                </div>
                </form> *@
            </div>
        </div>


        <span id="downloadallbtn-viewupload" class="text-danger"></span>

        <div class="table-responsive">

            <table class="table">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">Documents</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.wiseFiles)
                    {

                        <tr>
                            <td class="text-black">@item.FileName.Substring(52)</td>
                            <td>
                                <a class="text-decoration-none  btn btn-outline-info" href="~/UploadDocument/@item.FileName.Substring(52)" download>
                                    <i class="bi bi-cloud-arrow-down"></i>
                                </a>
                                <div class=" btn btn-outline-info DeleteDoc" id="@item.RequestWiseFileId">
                                    <i class="bi bi-trash  "></i>
                                </div>
                            </td>
                        </tr>
                    }

                </tbody>
            </table>
            <div class="py-3">
                <form>
                    <input type="number" asp-for="requestid" id="rid" value="@Model.requestid"  hidden/>
                    <div class=" pt-2">
                        <textarea class="form-control" name="" asp-for="Notes"
                                  placeholder="Notes" id="notes"
                                  style="height: 100px"></textarea>
                    </div>
                    <div class="d-flex justify-content-end pt-3 ">
                        <button type="button" class="btn btn-info text-white fw-normal savenote">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>


    </div>
</div>


<script>

    $('.savenote').click(function () {

        var reqid = $('#rid').attr('value');
        var notes = $('#notes').val();
        var viewModel = {
            requestid: reqid,
            BlockNotes: notes
        };
        console.log(viewModel)
        console.log(viewModel)
        console.log(viewModel)
        $.ajax({
            url: '/ProviderSide/PhysicianNotes', // replace with your URL
            type: 'POST',
            data: viewModel,
            success: function (data) {
                console.log('Success:', data);
            },
            error: function () {
                // Handle error
                console.log('Error occurred');
            }
        });

    });

</script>
@*
    $('.uploadbtn').on('click', function (e) {
        e.preventDefault();

        var formData = new FormData();
        for (var i = 0; i < actualBtn.files.length; i++) {
            formData.append('files', actualBtn.files[i]); // Append each selected file
        }
        formData.append('RequestsId' , @Model.RequestsId);
        console.log(formData);
        // Add any other data you need (e.g., RequestsId)

        $.ajax({
            url: '../Dashboard/UploadFiles', // Replace with your controller action URL
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                $('#nav-tabContent').html(response);
            },
            error: function (error) {
                console.error('Error uploading files:', error);
            }
        });
    }); *@
@*
<script>

    $(document).ready(function () {
        try {
            var actualBtn = document.getElementById('actual-btn');
            var fileChosen = document.getElementById('file-chosen');
            actualBtn.addEventListener('change', function () {
                var filesname = this.files[0].name;
                console.log(filesname)
                for (var i = 1; i < this.files.length; i++) {
                    filesname = filesname + " + " + this.files[i].name;
                }
                fileChosen.style.fontSize = "15px";
                fileChosen.style.fontWeight = "bold"
                fileChosen.textContent = filesname;
                fileChosen.ariaPlaceholder = filesname;
                console.log("run")
            })

            $('.uploadbtn').on('click', function (e) {
                e.preventDefault();
                var formData = new FormData();
                for (var i = 0; i < actualBtn.files.length; i++) {
                    formData.append('file', actualBtn.files[i]); // Append each selected file
                }
                formData.append('id', @Model.requestid);
                console.log(formData);
                // Add any other data you need (e.g., RequestsId)
                $.ajax({
                    url: '../Admin/UploadButton', // Replace with your controller action URL
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        $('#nav-home').html(response);
                    },
                    error: function (error) {
                        console.error('Error uploading files:', error);
                    }
                });
            });
        }
        catch {
            console.log("error");
        }


        // $('#uploadBtnAdmin').on('click', function () {
        //     var actualBtn = document.getElementById('actual-btn');
        //     var formData = new FormData();
        //     for (var i = 0; i < actualBtn.files.length; i++) {
        //         formData.append('files', actualBtn.files[i]); // Append each selected file
        //     }
        //     formData.append('requestid', @Model.requestid);
        //     console.log(formData);
        //     // Add any other data you need (e.g., RequestsId)

        //     $.ajax({
        //         url: '/Admin/UploadButton', // Replace with your controller action URL
        //         type: 'POST',
        //         data: formData,
        //         processData: false,
        //         contentType: false,
        //         success: function (response) {
        //             $('#nav-home').html(response);
        //         },
        //         error: function (error) {
        //             console.error('Error uploading files:', error);
        //         }
        //     });
        // });

        $('#downloadall').click(function () {
            console.log("hjbfgvd")
            $('.childCheckbox').prop('checked', $(this).prop('checked'));
        });

        // Handle individual checkbox clicks to update the leader checkbox state
        $('.childCheckbox').click(function () {
            console.log("another")

            $('#downloadall').prop('checked', $('.childCheckbox:checked').length === $('.childCheckbox').length);
        });


        $('#DeleteAll').click(function () {
            console.log("lol")
            $('.childCheckbox:checked').each(function () {
                var wiseFileId = $(this).attr('id');
                var reqid = @Model.requestid;
                console.log(reqid);
                console.log(wiseFileId);
                $.ajax({
                    url: '/Admin/DeleteDoc', // Replace with your controller action URL
                    type: 'POST',
                    data: {
                        wiseid: wiseFileId,
                        reqId: reqid
                    },

                    success: function (response) {
                        $('#nav-home').html(response);

                    },
                    error: function (error) {
                        console.error('Error uploading files:', error);
                    }
                });
            });
        });

        $('.DeleteDoc').on('click', function () {
            console.log("hello")
            var wiseFileId = $(this).attr('id');
            var reqid = @Model.requestid;
            console.log(wiseFileId)

            console.log(reqid)
            $.ajax({
                url: '/Admin/DeleteDoc', // Replace with your controller action URL
                type: 'POST',
                data: {
                    wiseid: wiseFileId,
                    reqId: reqid
                },

                success: function (response) {
                    $('#nav-home').html(response);

                },
                error: function (error) {
                    console.error('Error uploading files:', error);
                }
            });
        });

        $('#sendMail').on('click', function (e) {
            e.preventDefault();
            console.log("not yet")
            var formData = new FormData();

            $('input[name="checkbox"]:checked').each(function () {
                var wiseid = $(this).attr('id');

            formData.append('wiseFileId', wiseid);
            });

            formData.append('reqid', @Model.requestid);
            console.log(formData);

            $.ajax({
                url: '/Admin/SendMail', // Replace with your controller action URL
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,

                success: function (response) {
                    $('#nav-home').html(response);

                },
                error: function (error) {
                    console.error('Error uploading files:', error);
                }
            });
        })

    });


    // Event listener for download button
    document.getElementById('downloadSelected').addEventListener('click', function (event) {
        event.preventDefault();
        downloadFiles();
    });




                                    // var actualBtn = document.getElementById('actual-btn');
                                    // var fileChosen = document.getElementById('file-chosen');

                                    // actualBtn.addEventListener('change', function () {
                                    //     fileChosen.textContent = this.files[0].name
                                    //     fileChosen.placeholder = this.files[0].name
                                    //     fileChosen.value = this.files[0].name

                                    // })

</script>
 *@
