@using Services.ViewModels

@model InvoicingViewAll

<div class="form-container mb-4">

    <form id="timesheetPeriodForm">
        <div class="table-responsive bg-white shadow">
            <table class="table align-middle md-txt">
                <thead class="fw-bold bg-secondary text-white">
                    <tr>
                        <td>Date</td>
                        <td>On-Call Hours</td>
                        <td>Total Hours</td>
                        <td class="text-center">Weekend/ Holiday</td>
                        <td>Number of Housecalls</td>
                        <td>Number of Phone Consults</td>
                    </tr>
                </thead>
                <tbody>
                    @for (var i = 0; i < Model.Invoicing.Count(); i++)
                    {
                        <tr>
                            <input type="hidden" name="[@i].physicianId" value="@Model.Invoicing.ToList()[0].physicianId" />
                            <input type="hidden" name="[@i].TimeSheetDetailId" value="@Model.Invoicing.ToList()[i].TimeSheetDetailId" />
                            <td>
                                @Model.Invoicing.ToList()[i].Date.ToString("MM/dd/yyyy")
                                <input type="hidden" name="[@i].Date" value="@Model.Invoicing.ToList()[i].Date" />
                            </td>
                            <td>
                                @Model.Invoicing.ToList()[i].onCallHours
                                <input type="hidden" name="[@i].onCallHours" value="@Model.Invoicing.ToList()[i].onCallHours" />
                            </td>
                            <td>
                                <input type="number" name="[@i].totalHours" value="@Model.Invoicing.ToList()[i].totalHours" class="form-control form-field" required min="0" max="24" />
                            </td>
                            <td class="text-center">
                                @* <input type="checkbox" value="@Model.Invoicing.ToList()[i].isWeekend" name="[@i].isWeekend" @(Model.Invoicing) /> *@
                                @if (Model.Invoicing.ToList()[i].isWeekend == true)
                                {
                                    <center><input type="checkbox" name="[@i].isWeekend" class="form-check-input" value="true" checked /></center>
                                }
                                else
                                {
                                    <center><input type="checkbox" name="[@i].isWeekend" class="form-check-input" value="true" /></center>
                                }
                            </td>
                            <td>
                                <input type="number" name="[@i].noOfHouseCalls" value="@Model.Invoicing.ToList()[i].noOfHouseCalls" class="form-control form-field" required min="0" max="20" />
                            </td>
                            <td>
                                <input type="number" name="[@i].noOfPhoneConsults" value="@Model.Invoicing.ToList()[i].noOfPhoneConsults" class="form-control form-field" required min="0" max="30" />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="d-flex w-100 justify-content-end">
                <button id="timesheetSubmitBtn" type="submit" class="btn btn-info p-2 mb-3 me-3">Submit</button>
            </div>
        </div>
    </form>
</div>

<script asp-append-version="true">
    $("#timesheetSubmitBtn").click(function () {
        event.preventDefault();
        var formData = new FormData($("#timesheetPeriodForm")[0]);

        if (!$("#timesheetPeriodForm").valid()){
            return;
        }

        $.ajax({
            url: '/ProviderSide/AddUpdateTimesheetDetails',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {

                if (response.success) {
                    Swal.fire({
                        position: "top-end",
                        icon: "success",
                        title: "Response submited successfull...!",
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
                if (response.fail) {
                    Swal.fire({
                        position: "top-end",
                        icon: "error",
                        title: "Something Went wrong Try Again",
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
                let month = $("#monthSpan").text();
                let half = $("#halfSpan").text();
                getMonthHalfTimesheet(month, half);
                getMonthHalfReceiptData(month, half);
            },
            error: function () {

            }
        });
    });
</script>